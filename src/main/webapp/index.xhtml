<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
        <f:facet name="first">
            <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
            <title>lEEnkit</title>
            <h:outputStylesheet library="css" name="mystyle.css"/>
        </f:facet>
        <script src="http://maps.google.com/maps/api/js?sensor=false"
                type="text/javascript">                    
        </script>
    </h:head>

    <h:body>      
        <f:view locale="#{localeBean.locale}"/>

        <p:dialog header="Settings" widgetVar="settingsDialog"
                  modal="true" resizable="false"
                  showEffect="fade" hideEffect="fade">
            <h:form enctype="multipart/form-data">
                #{txt.lang}:
                <h:selectOneMenu value="#{localeBean.localeCode}">
                    <f:selectItems value="#{localeBean.languages}"/> 
                </h:selectOneMenu>
                <br/>
                #{txt.lang}:
                <h:selectOneMenu value="#{localeBean.unitString}">
                    <f:selectItems value="#{localeBean.units}"/> 
                </h:selectOneMenu>
                <br/>
                <p:outputLabel value="property n" />
                <br/>

                <p:commandButton value="Cancel" onclick="PF('settingsDialog').hide()"/>
                <p:commandButton value="Save" ajax="false"
                                 actionListener="#{dataBean.applySettings}"/>
            </h:form>
        </p:dialog> 

        <p:dialog header="Upload new Track" widgetVar="uploadDialog"
                  modal="true" resizable="false"                  
                  showEffect="fade" hideEffect="fade">
            <h:form enctype="multipart/form-data">
                <p:inputTextarea rows="4" cols="35" title="Track description"
                                 placeholder="Track description"
                                 value="#{dataBean.description}"/>
                <br/>
                <p:fileUpload mode="simple" value="#{dataBean.gpxFile}"/>
                <p:commandButton value="Cancel" onclick="PF('uploadDialog').hide()"/>
                <p:commandButton value="Upload" ajax="false"
                                 actionListener="#{dataBean.uploadFile}"/>
                <p:growl id="uploadmsg" showDetail="true" />
            </h:form>
        </p:dialog> 


        <div style="width: 480px; height: 480px; float: left; margin-left: 5%;">
            <h:form style="width: 100%; padding: 10px;">

                <p:menuButton value="#{dataBean.username}">
                    <p:menuitem value="Add new Track" icon="ui-icon-plusthick"
                                onclick="PF('uploadDialog').show();"/>
                    <p:menuitem value="Settings" icon="ui-icon-wrench"
                                onclick="PF('settingsDialog').show();" />
                    <p:separator />
                    <p:menuitem value="Log Out" icon="ui-icon-extlink"
                                action="#{userManager.logout}" />
                </p:menuButton> 

                <div style="float: right; margin: 10px;">
                    <p:clock pattern="dd.MM.yyyy HH:mm:ss" mode="server"/>
                </div>
            </h:form> 
            
            <h:form id="trackform">  
                <p:dataList var="track" value="#{dataBean.trackList}" type="definition"
                            style="width:480px; float: left;">
                    <f:facet name="header">#{txt.track_header}</f:facet>  
                    <p:commandButton value="#{track.name}" ajax="false">
                        <f:setPropertyActionListener value="#{track}"
                                                     target="#{dataBean.track}"/>
                    </p:commandButton>
                </p:dataList> 
            </h:form>
        </div>
        
        <div id="mapcontainer">
            <p:gmap id="gmap" center="#{dataBean.mapCenter}" zoom="11" type="hybrid"
                    model="#{dataBean.polylineModel}"
                    style="width:480px; height:480px; float: left;"/>
        </div>

        <h:form id="dform">   
            <p:panel header="Track information" 
                     style="width: 90%; margin-left: 5%; margin-top: 25px; float: left;">
            <div class="ui-grid ui-grid-responsive" >
                <div class="ui-grid-row" >
                    <div class="ui-grid-col-4">
                        Distance
                        <br/>
                        <p:inputText value="#{dataBean.track.distance}"
                                     disabled="#{dataBean.disabled}"
                                     size="7" maxlength="6"/>
                        km
                    </div>
                    <div class="ui-grid-col-4">
                        Duration
                        <br/>
                        <p:inputText value="#{dataBean.track.duration}"
                                     disabled="#{dataBean.disabled}"
                                     size="9" maxlength="8"/>
                    </div>
                    <div class="ui-grid-col-4">
                        Average Speed
                        <br/>
                        <p:inputText value="#{dataBean.track.avgSpeed}"
                                     disabled="#{dataBean.disabled}"
                                     size="7" maxlength="6"/>
                        kmh
                    </div>
                </div>
                <div class="ui-grid-row">Description</div>
                <div class="ui-grid-row">
                    <div class="ui-grid-col-8">
                        <p:inputText value="#{dataBean.track.description}"
                                     disabled="#{dataBean.disabled}"
                                     size="40" maxlength="200"/>
                    </div>
                    <div class="ui-grid-col-4">
                        <p:commandButton value="#{dataBean.buttonText}"
                                         actionListener="#{dataBean.editData}"
                                         update="dform"/>
                        <p:commandButton value="Save" actionListener="#{dataBean.saveData}"
                                         update="dform" rendered="#{!dataBean.disabled}"/>
                    </div>
                </div>
            </div> 
            </p:panel>
        </h:form> 
        <p:separator />
    </h:body>
</html>

